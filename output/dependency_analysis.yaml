analysis_version: "1.0.0"
generated_at: "2024-03-21"
project_summary:
  name: "Todo Application"
  total_components: 12
  analyzed_files: 12
  risk_level: "high"  # based on overall_metrics.security_risk

security_analysis:
  critical_components:
    - name: "AuthController"
      risk_score: 0.9
      test_coverage_required: 100%
      security_measures:
        - "認証フローの厳密なバリデーション"
        - "セッション管理の強化"
        - "レート制限の実装"

    - name: "User"
      risk_score: 1.0
      test_coverage_required: 100%
      security_measures:
        - "パスワードハッシュ化の確認"
        - "個人情報の暗号化"
        - "アクセス制御の強化"

  security_flows:
    authentication:
      criticality: 1.0
      components: ["AuthController", "AuthService", "User"]
      required_measures:
        - "多要素認証の検討"
        - "セッショントークンの適切な管理"
        - "失敗回数制限の実装"

    authorization:
      criticality: 0.8
      components: ["TodoPolicy", "TagPolicy"]
      required_measures:
        - "ポリシーチェックの確実な実施"
        - "権限昇格の防止"

complexity_analysis:
  high_complexity_components:
    - name: "TodoController"
      complexity_score: 0.8
      factors:
        - "多数の依存コンポーネント"
        - "複雑な制御フロー"
        - "高いファンアウト"
      recommendations:
        - "ファサードパターンの導入"
        - "責務の分割"

    - name: "TagController"
      complexity_score: 0.7
      factors:
        - "複数のモデル操作"
        - "認可チェックの複雑さ"
      recommendations:
        - "サービス層の強化"
        - "ビジネスロジックの分離"

dependency_chains:
  critical_chains:
    - name: "認証チェーン"
      components: ["AuthController", "AuthService", "User"]
      risk_level: "high"
      test_priority: 1.0

    - name: "Todo管理チェーン"
      components: ["TodoController", "TodoService", "Todo", "Tag"]
      risk_level: "high"
      test_priority: 0.8

  problematic_cycles:
    - name: "Model循環参照"
      components: ["Todo", "Tag"]
      severity: "medium"
      mitigation: "一方向の依存関係への変更"

    - name: "Policy-Model循環"
      components: ["TodoPolicy", "Todo", "Tag"]
      severity: "high"
      mitigation: "インターフェース導入による依存関係の逆転"

test_strategy:
  coverage_requirements:
    overall: 85%
    security_critical: 100%
    high_complexity: 90%

  priority_components:
    - name: "AuthController"
      min_coverage: 100%
      focus_areas: ["認証ロジック", "エラーハンドリング"]

    - name: "TodoController"
      min_coverage: 90%
      focus_areas: ["データ整合性", "認可チェック"]

  integration_tests:
    critical_flows:
      - name: "認証フロー"
        coverage_required: 100%
        performance_sla: "500ms"

      - name: "Todo管理フロー"
        coverage_required: 90%
        performance_sla: "800ms"

refactoring_recommendations:
  high_priority:
    - target: "Todo-Tag関係"
      current_issue: "循環参照による依存関係の複雑化"
      suggestion: "一方向の依存関係への変更"
      impact: "保守性の向上、テスト容易性の改善"

    - target: "Policy-Model関係"
      current_issue: "ポリシーとモデル間の強結合"
      suggestion: "インターフェースを用いた依存関係の抽象化"
      impact: "柔軟性の向上、テスト容易性の改善"

  medium_priority:
    - target: "Controller層"
      current_issue: "高い複雑性とファンアウト"
      suggestion: "ファサードパターンの導入とサービス層の強化"
      impact: "コードの整理、責務の明確化"

monitoring_recommendations:
  security_monitoring:
    - component: "User"
      metrics: ["認証失敗率", "アカウントロック頻度"]
      alerts:
        - condition: "認証失敗率 > 10%"
          severity: "high"

    - component: "AuthController"
      metrics: ["リクエスト頻度", "エラーレート"]
      alerts:
        - condition: "エラーレート > 5%"
          severity: "high"

  performance_monitoring:
    - flow: "認証フロー"
      sla: "500ms"
      metrics: ["レスポンスタイム", "スループット"]

    - flow: "Todo管理フロー"
      sla: "800ms"
      metrics: ["レスポンスタイム", "データベース接続数"]

maintenance_guidelines:
  code_review_focus:
    - area: "セキュリティ関連コード"
      reviewers_required: 2
      check_points:
        - "認証ロジックの変更"
        - "権限チェックの変更"

    - area: "モデル間関係"
      reviewers_required: 1
      check_points:
        - "循環参照の防止"
        - "依存関係の方向性"

  testing_guidelines:
    - component_type: "セキュリティ重要"
      requirements:
        - "単体テスト100%カバレッジ"
        - "統合テストでのE2Eシナリオ"
        - "セキュリティテストの実施"

    - component_type: "ビジネスロジック"
      requirements:
        - "単体テスト90%カバレッジ"
        - "主要フローの統合テスト"